name: Stock Genius TW System

on:
  workflow_dispatch:
  schedule:
    # ğŸ‡¹ğŸ‡¼ å°è‚¡ç›¤å¾Œ 1 å°æ™‚
    # å°è‚¡æ”¶ç›¤ç´„ 13:30ï¼ˆUTC+8ï¼‰
    # 14:30 å°ç£æ™‚é–“ = 06:30 UTC
    - cron: "30 6 * * 1-5"

jobs:
  guardian-gate:
    name: Guardian Pause Gate (TW)
    runs-on: ubuntu-latest
    outputs:
      allowed: ${{ steps.gate.outputs.allowed }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Guardian Pause Check
        id: gate
        run: |
          python shared/check_guardian_gate.py
        env:
          GUARDIAN_STATE_PATH: shared/guardian_state.json

  genius-tw:
    name: Run Stock Genius TW
    needs: guardian-gate
    if: needs.guardian-gate.outputs.allowed == 'true'
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r repos/Stock-Genius-System/requirements.txt

      - name: Run Stock Genius TW AI
        env:
          DISCORD_WEBHOOK_TW: ${{ secrets.DISCORD_WEBHOOK_TW }}
        run: |
          python repos/Stock-Genius-System/scripts/ai_tw_post.py
