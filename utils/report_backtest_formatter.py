# report_backtest_formatter.py
# å›æ¸¬å ±å‘Šæ’ç‰ˆå™¨ï¼ˆçµ‚æ¥µå°é ‚ç©©å®šç‰ˆï¼‰
# è·è²¬ï¼š
# - åƒ…è² è²¬ã€Œå­—ä¸²æ’ç‰ˆã€
# - å›ºå®šæ¬„å¯¬ï¼Œæ°¸ä¹…ä¸è·‘ç‰ˆï¼ˆäº¤æ˜“ç­†æ•¸å†å¤šä¹Ÿä¸æ“ å£“ï¼‰
# - å°ˆä¾› Discord / å ±å‘Šä½¿ç”¨
# âŒ ä¸è¨ˆç®— âŒ ä¸è®€æª” âŒ ä¸å­¸ç¿’ âŒ ä¸ä¾è³´å¸‚å ´åˆ¥

from typing import Dict

# -------------------------------------------------
# å›ºå®šæ¬„å¯¬è¨­å®šï¼ˆéµå¾‹ï¼šé¿å…æ“ å£“ï¼‰
# -------------------------------------------------

LEFT_WIDTH = 18   # å·¦æ¬„å›ºå®šå¯¬
RIGHT_WIDTH = 18  # å³æ¬„å›ºå®šå¯¬


# -------------------------------------------------
# å…¬é–‹ API
# -------------------------------------------------

def format_backtest_section(stats: Dict) -> str:
    """
    å°‡ backtest_stats_builder çš„è¼¸å‡º
    ç©©å®šæ ¼å¼åŒ–ç‚º Discord å‹å–„å­—ä¸²
    """

    sample = stats.get("sample_size", 0)
    hit_rate = f"{round(stats.get('hit_rate', 0.0) * 100, 1)}%"

    bands = stats.get("by_confidence_band", {})
    high = f"{round(bands.get('high', {}).get('rate', 0.0) * 100):.0f}%"
    mid  = f"{round(bands.get('mid', {}).get('rate', 0.0) * 100):.0f}%"
    low  = f"{round(bands.get('low', {}).get('rate', 0.0) * 100):.0f}%"

    # âš ï¸ ç›®å‰æœªæ¥ç¸¾æ•ˆæ¨¡çµ„ï¼Œä¿ç•™ç©©å®šå ä½ï¼ˆæœªä¾†å¯ç„¡ç—›å‡ç´šï¼‰
    avg_return = "â€”"
    max_dd = "â€”"

    # -------------------------------------------------
    # ç©©å®šæ’ç‰ˆï¼ˆæ‰€æœ‰æ¬„ä½å›ºå®šå¯¬åº¦ï¼‰
    # -------------------------------------------------

    lines = [
        "",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",
        "ğŸ“Š è¿‘ 5 æ—¥å›æ¸¬çµç®—",
        "",
        f"{'äº¤æ˜“ç­†æ•¸ï¼š':<10}{str(sample) + ' ç­†':<{LEFT_WIDTH}}"
        f"{'ä¿¡å¿ƒåˆ†ç´šå‘½ä¸­ç‡':<{RIGHT_WIDTH}}",

        f"{'å¯¦éš›å‘½ä¸­ï¼š':<10}{hit_rate:<{LEFT_WIDTH}}"
        f"ğŸŸ¢ é«˜ä¿¡å¿ƒ (>60%) ï¼š{high}",

        f"{'å¹³å‡å ±é…¬ï¼š':<10}{avg_return:<{LEFT_WIDTH}}"
        f"ğŸŸ¡ ä¸­ä¿¡å¿ƒ (30â€“60%)ï¼š{mid}",

        f"{'æœ€å¤§å›æ’¤ï¼š':<10}{max_dd:<{LEFT_WIDTH}}"
        f"ğŸ”´ ä½ä¿¡å¿ƒ (<30%) ï¼š{low}",

        "",
        "âš ï¸ æ¨¡å‹ç‚ºæ©Ÿç‡æ¨ä¼°ï¼Œåƒ…ä¾›ç ”ç©¶åƒè€ƒï¼ŒéæŠ•è³‡å»ºè­°ã€‚"
    ]

    return "\n".join(lines)
