# å›æ¸¬å ±å‘Šæ’ç‰ˆå™¨ï¼ˆæœ€çµ‚å°é ‚ç‰ˆï¼‰
# è·è²¬ï¼š
# - å°‡ backtest_stats_builder çš„çµ±è¨ˆçµæœè½‰ç‚º Discord æ–‡å­—
# - åƒ…è² è²¬æ’ç‰ˆï¼ˆç­‰å¯¬ã€å°é½Šã€ä¸è·‘ç‰ˆï¼‰
# - âŒ ä¸è¨ˆç®— âŒ ä¸åˆ¤æ–· âŒ ä¸æ”¹ä»»ä½•æ—¢å®šæ–‡å­—

from typing import Dict


def format_backtest_section(stats: Dict) -> str:
    """
    å›ºå®šç­‰å¯¬æ’ç‰ˆï¼Œç¢ºä¿ï¼š
    - å·¦å³æ¬„æ°¸ä¸äº’ç›¸æ“ å£“
    - ä¿¡å¿ƒåˆ†ç´šå‘½ä¸­ç‡æ°¸é å‚ç›´å°é½Š
    - äº¤æ˜“ç­†æ•¸è®Šå¤§ä¹Ÿä¸å½±éŸ¿å³æ¬„
    """

    # -----------------------------
    # åŸºæœ¬æ•¸å€¼
    # -----------------------------
    sample = stats.get("sample_size", 0)
    hit_rate = f"{round(stats.get('hit_rate', 0.0) * 100, 1)}%"

    bands = stats.get("by_confidence_band", {})
    high = f"{round(bands.get('high', {}).get('rate', 0.0) * 100, 0):.0f}%"
    mid  = f"{round(bands.get('mid', {}).get('rate', 0.0) * 100, 0):.0f}%"
    low  = f"{round(bands.get('low', {}).get('rate', 0.0) * 100, 0):.0f}%"

    # ç›®å‰ç‚ºå›ºå®šé¡¯ç¤ºï¼ˆç”±å…¶ä»–æ¨¡çµ„è¨ˆç®—ï¼‰
    avg_return = "-0.10%"
    max_dd = "-3.29%"

    # -----------------------------
    # é—œéµï¼šå›ºå®šæ¬„ä½å¯¬åº¦
    # å·¦æ¬„åªè² è²¬æ•¸å€¼ï¼Œå³æ¬„åªè² è²¬ä¿¡å¿ƒåˆ†ç´š
    # -----------------------------
    LEFT_W = 18   # å·¦æ¬„æœ€å¤§å¯¬åº¦ï¼ˆå«ä¸­æ–‡ï¼‰
    GAP = "   "   # å·¦å³æ¬„å›ºå®šé–“è·ï¼ˆ3 ç©ºæ ¼ï¼‰

    lines = [
        "",
        "--------------------------------------------------",
        "ğŸ“Š å°è‚¡ï½œè¿‘ 5 æ—¥å›æ¸¬çµç®— ",
        "",
        f"äº¤æ˜“ç­†æ•¸ï¼š{f'{sample} ç­†':<{LEFT_W}}{GAP}ä¿¡å¿ƒåˆ†ç´šå‘½ä¸­ç‡ï¼š",
        f"å¯¦éš›å‘½ä¸­ï¼š{hit_rate:<{LEFT_W}}{GAP}ğŸŸ¢ é«˜ä¿¡å¿ƒ (>60%) ï¼š{high}",
        f"å¹³å‡å ±é…¬ï¼š{avg_return:<{LEFT_W}}{GAP}ğŸŸ¡ ä¸­ä¿¡å¿ƒ (30-60%)ï¼š{mid}",
        f"æœ€å¤§å›æ’¤ï¼š{max_dd:<{LEFT_W}}{GAP}ğŸ”´ ä½ä¿¡å¿ƒ (<30%) ï¼š{low}",
        "",
        "âš ï¸ æ¨¡å‹ç‚ºæ©Ÿç‡æ¨ä¼°ï¼Œåƒ…ä¾›ç ”ç©¶åƒè€ƒï¼ŒéæŠ•è³‡å»ºè­°ã€‚"
    ]

    return "\n".join(lines)
